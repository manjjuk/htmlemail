<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Memo Creator</title>
<style>
    body {
        font-family: "Palatino Linotype", "Book Antiqua", Palatino, serif;
        font-size: 16px;
        margin: 20px;
        text-align: justify;
        hyphens: auto;
    }
    h1 {
        text-align: center;
        margin-bottom: 20px;
    }
    label {
        display: block;
        margin-top: 10px;
    }
    input, textarea, button {
        font-family: "Palatino Linotype", "Book Antiqua", Palatino, serif;
        font-size: 18px;
        box-sizing: border-box;
    }
    input, textarea {
        width: 100%;
        padding: 5px;
        margin-top: 5px;
    }
    textarea {
        height: 120px;
    }
    #commentsLabel {
        font-size: 18px;
        font-weight: bold;
    }
    button {
        margin-top: 10px;
        padding: 10px 15px;
        cursor: pointer;
        background-color: #4CAF50;
        color: white;
        border: none;
        border-radius: 4px;
    }
    button:hover {
        background-color: #45a049;
    }
    #uploadJson {
        display: inline-block;
        margin-left: 10px;
        padding: 10px 15px;
        background-color: #4CAF50;
        color: white;
        border: none;
        border-radius: 4px;
        cursor: pointer;
    }
    #uploadJson:hover {
        background-color: #45a049;
    }
    .note {
        font-size: 12px;
        margin-top: 15px;
        color: #555;
    }
    @media print {
        body {
            font-size: 12px;
        }
    }
</style>
</head>
<body>

<h1>Memo Creator</h1>

<form id="memoForm">
    <label for="project">Project:</label>
    <input type="text" id="project" name="project">

    <label for="date">Date:</label>
    <input type="date" id="date" name="date">

    <label for="by">By:</label>
    <input type="text" id="by" name="by">

    <label for="subject">Subject:</label>
    <input type="text" id="subject" name="subject">

    <label id="commentsLabel" for="comments">Comments:</label>
    <textarea id="comments" name="comments"></textarea>

    <button type="button" onclick="previewMemo()">Preview</button>
    <button type="button" onclick="downloadJSON()">Download JSON</button>
    <label id="uploadJson">
        Upload JSON
        <input type="file" accept=".json" style="display:none" onchange="uploadJSON(event)">
    </label>

    <p class="note">Note: To create auto bullet points, start a line with "-" and press Enter. The next line will automatically start with "-".</p>
</form>

<script>
// Auto-bullet feature
const textarea = document.getElementById('comments');
textarea.addEventListener('keydown', function(e) {
    if (e.key === 'Enter') {
        const start = this.selectionStart;
        const value = this.value;
        const lines = value.substring(0, start).split("\n");
        const currentLine = lines[lines.length - 1];
        if (currentLine.trim().startsWith('-')) {
            e.preventDefault();
            const bullet = '- ';
            const end = this.selectionEnd;
            this.value = value.substring(0, start) + "\n" + bullet + value.substring(end);
            this.selectionStart = this.selectionEnd = start + 1 + bullet.length;
        }
    }
});

// Preview memo
function previewMemo() {
    const project = document.getElementById('project').value;
    
    let date = document.getElementById('date').value;
    if (date) {
    const d = new Date(date);
    date = d.toLocaleDateString("en-GB", { day: "2-digit", month: "long", year: "numeric" });
    }

    const by = document.getElementById('by').value;
    const subject = document.getElementById('subject').value;
    let comments = document.getElementById('comments').value;

    const lines = comments.split('\n');
    let inList = false;
    let htmlComments = '';
    lines.forEach(line => {
        const bulletMatch = line.match(/^\s*-\s+(.*)/);
        if (bulletMatch) {
            if (!inList) {
                htmlComments += '<ul>';
                inList = true;
            }
            htmlComments += `<li>${bulletMatch[1]}</li>`;
        } else {
            if (inList) {
                htmlComments += '</ul>';
                inList = false;
            }
            htmlComments += `<p>${line}</p>`;
        }
    });
    if (inList) htmlComments += '</ul>';

    const memoWindow = window.open('', '_blank', 'width=600,height=600');
    memoWindow.document.write(`<html><head><title>Comments</title>
        <style>
            body { 
                font-family: "Palatino Linotype", "Book Antiqua", Palatino, serif; 
                font-size: 16px; 
                text-align: justify; 
                hyphens: auto;
            }
            #comments { font-size: 20px; font-weight: bold; margin-top: 10px; }
            ul { margin: 5px 0; padding-left: 20px; }
        </style>
        </head><body>`);
    memoWindow.document.write(`<p><strong>Project:</strong> ${project}</p>`);
    memoWindow.document.write(`<p><strong>Date:</strong> ${date}</p>`);
    memoWindow.document.write(`<p><strong>By:</strong> ${by}</p>`);
    memoWindow.document.write(`<p><strong>Subject:</strong> ${subject}</p>`);
    memoWindow.document.write(`<p id="comments"><strong>Comments:</strong></p>${htmlComments}`);
    memoWindow.document.write(`</body></html>`);
    memoWindow.document.close();
}

// JSON download
function downloadJSON() {
    const memoData = {
        project: document.getElementById('project').value,
        date: document.getElementById('date').value,
        by: document.getElementById('by').value,
        subject: document.getElementById('subject').value,
        comments: document.getElementById('comments').value
    };
    const blob = new Blob([JSON.stringify(memoData, null, 2)], { type: "application/json" });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = 'memo.json';
    a.click();
    URL.revokeObjectURL(url);
}

// JSON upload
function uploadJSON(event) {
    const file = event.target.files[0];
    if (!file) return;
    const reader = new FileReader();
    reader.onload = function(e) {
        const data = JSON.parse(e.target.result);
        document.getElementById('project').value = data.project || '';
        document.getElementById('date').value = data.date || '';
        document.getElementById('by').value = data.by || '';
        document.getElementById('subject').value = data.subject || '';
        document.getElementById('comments').value = data.comments || '';
    }
    reader.readAsText(file);
}
</script>

</body>
</html>
